<% content_for :head do %>
    <%= stylesheet_link_tag "index.css" %>
<% end %>

<%= hidden_field_tag "page_source", "index" %>

<a name="home"></a>
<div class="header">
    <div class="slide-container">
        <div id="wrapper">
            <div id="slider-wrap" class="active">
                <ul id="slider">
                    <% @posts.each do |post| %>
                        <%  
                            case post.pointer_type
                            when "FEATURES"
                                url = "/features/#{post.pointer_id}"
                            when "TREND"
                                url = "/trend/#{post.pointer_id}"
                            when "ON_COURT"
                                url = "/oncourt/#{post.pointer_id}"
                            end
                        %>
                        <li style="background:linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),url(<%= post.image.url %>)">
                            <a href="<%= url %>">
                                <div class="slide-filter">
                                    <h3><%= @chinese ? post.title_cn : post.title_en %></h3>
                                </div>
                            </a>
                        </li>
                    <% end %> 
                </ul>
                <div class="slide-btns" id="next"><i class="fa fa-arrow-right"></i></div>
                <div class="slide-btns" id="previous"><i class="fa fa-arrow-left"></i></div>
                <div id="pagination-wrap">
                    <ul></ul>
                </div> 
            </div>
        </div>
    </div>
</div>

<div class="main container">
    <div class="row">
        <% @news.each do |news| %>
            <div class="banner-box col-sm-4">
                <div class="new-box">
                    <%  
                        case news.pointer_type
                        when "FEATURES"
                            url = "/features/#{news.pointer_id}"
                        when "CALENDAR"
                            date = CalendarPost.find_by_id(news.pointer_id).release_date.strftime("%Y-%m-%d")
                            url = "/calendar?date=#{date}"
                        when "TREND"
                            url = "/trend/#{news.pointer_id}"
                        when "ON_COURT"
                            url = "/oncourt/#{news.pointer_id}"
                        end
                    %>
                    <a href="<%= url %>">
                        <%= image_tag news.image.url %>
                        <div class="kicks-filter">
                            <p><%= news.title %></p>
                        </div>
                    </a>
                </div>
            </div>
        <% end %>
    </div>
    
    <!-- maximum should be three only (more will be loaded by ajax) -->
    <% @feeds.each_with_index do |feed, index| %>
        <div class="kicks-box clearfix<%=' last' if index == @feeds.size-1%>">
            <%
                case feed.class.name
                when "FeaturePost"
                    link = "/features/#{feed.id}"
                    tag = "Features"
                when "TrendPost"
                    link = "/trend/#{feed.id}"
                    tag = "Trend"
                when "OnCourtPost"
                    link = "/oncourt/#{feed.id}"
                    tag = "On_Court"
                end
            %>
            <a href="<%= link %>">
                <%= image_tag feed.cover_image.url, :class => "col-xs-12 col-sm-4 kicks-pic" %>
            </a>
            <div class="col-xs-12 col-sm-8 kicks-intro">
                <a href="<%= link %>">
                    <div class="feed-title">
                        <h3><%= feed.title %></h3>
                    </div>
                </a>
                <hr class="title-divider">
                <div class="kicks-intro-content">
                    <p><%= ActionView::Base.full_sanitizer.sanitize(feed.content[0][0..120]) %>...</p>
                    <a href="<%= link %>">(<%= t("more") %>)</a>
                    <span class="post-date"><%= feed.created_at.strftime("%Y-%m-%d") %></span>
                    <br/><br/>
                    <i class="fa fa-tags" aria-hidden="true"></i><span class="post-tag"><%= t(tag) %></span>
                </div>
            </div>
        </div>
    <% end %>
    <% unless @no_more  %>
        <div class="to-view-more">
            <span><%= t("Click_to_view_more") %> <i class="fa fa-arrow-circle-down" aria-hidden="true"></i></span>
        </div>
    <% end %>
    <%= hidden_field_tag "next_page", "2", :name => nil %>
</div>

<% content_for :end_of_body do %>
   <%= javascript_include_tag "index.js" %>
<% end %>